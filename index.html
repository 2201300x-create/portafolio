<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Portafolio - Analizador CFE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <style>
        body {
            color:#000; padding-bottom:8rem; margin:0;
            background-image:linear-gradient(rgba(248,250,252,.85),rgba(248,250,252,.85)),url('1.png');
            background-repeat:no-repeat; background-size:cover;
            font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
        }
        .retry_home {
            box-shadow:0 10px 15px -3px rgba(0,0,0,.1);
            background-image:linear-gradient(135deg,#6366f1,#a855f7,#ec4899);
            height:14rem; position:relative;
            border-bottom-right-radius:3rem; border-bottom-left-radius:3rem;
        }
        .perfil { padding:0 1.5rem; margin-top:-5rem; z-index:10; position:relative; max-width:45rem; margin-left:auto; margin-right:auto; }
        .bg-user { background:#fff; padding:2rem; border-radius:3rem; box-shadow:0 4px 6px -1px rgba(0,0,0,.1); }

        /* ── Modales ── */
        .modal-overlay {
            display:none; position:fixed; inset:0;
            background:rgba(0,0,0,.55); backdrop-filter:blur(5px);
            z-index:50; align-items:center; justify-content:center; padding:1rem;
        }
        .modal-content {
            background:#fff; border-radius:2rem; width:100%;
            max-width:680px; max-height:93vh; overflow-y:auto;
            padding:2rem; box-shadow:0 25px 60px rgba(0,0,0,.2);
        }
        .modal-wide { max-width:900px; }

        /* ── Botones header ── */
        .btn-scan {
            background:#6366f1; color:white; padding:.5rem 1rem; border-radius:9999px;
            font-size:.875rem; font-weight:600; display:flex; align-items:center;
            gap:.5rem; transition:all .2s; cursor:pointer; border:none;
        }
        .btn-scan:hover { background:#4f46e5; transform:scale(1.05); }
        .btn-multi { background:#10b981; }
        .btn-multi:hover { background:#059669; }

        /* ── Drop zone ── */
        .drop-zone {
            border:2px dashed #c7d2fe; border-radius:1.5rem; padding:2.5rem 2rem;
            text-align:center; cursor:pointer; transition:all .25s; background:#f5f3ff;
        }
        .drop-zone:hover, .drop-zone.over { border-color:#6366f1; background:#ede9fe; }
        .drop-zone input { display:none; }
        .drop-zone-green { border-color:#a7f3d0; background:#f0fdf4; }
        .drop-zone-green:hover, .drop-zone-green.over { border-color:#10b981; background:#dcfce7; }

        /* ── Chips ── */
        .file-chip {
            display:inline-flex; align-items:center; gap:.4rem;
            background:#e0e7ff; color:#4338ca;
            padding:.3rem .8rem; border-radius:9999px; font-size:.75rem; font-weight:700;
        }

        /* ── Spinner ── */
        .spinner { width:38px; height:38px; border:4px solid #e0e7ff; border-top-color:#6366f1; border-radius:50%; animation:girar .8s linear infinite; margin:0 auto; }
        .spinner-green { border-color:#a7f3d0; border-top-color:#10b981; }
        @keyframes girar { to { transform:rotate(360deg); } }
        .barra-fondo { background:#e0e7ff; border-radius:9999px; height:6px; overflow:hidden; }
        .barra-fill  { height:100%; background:linear-gradient(90deg,#6366f1,#a855f7); border-radius:9999px; transition:width .3s; }
        .barra-fill-green { background:linear-gradient(90deg,#10b981,#06b6d4); }

        /* ── Cards resultado simple ── */
        .card-id   { background:#fff; border:1px solid #e2e8f0; border-radius:1.25rem; padding:1.1rem; }
        .card-blue { background:#1d4ed8; border-radius:1.25rem; padding:1.25rem; color:#fff; }
        .card-pay  { background:#fff; border:1px solid #e2e8f0; border-radius:1.25rem; padding:1.1rem; }
        .eng-card  { background:#f8fafc; border:1px solid #e2e8f0; border-radius:1.25rem; padding:1rem; }
        .bl-blue   { border-left:4px solid #3b82f6; padding-left:.75rem; }
        .bl-yellow { border-left:4px solid #f59e0b; padding-left:.75rem; }
        .hist-row  { display:flex; justify-content:space-between; align-items:center; padding:.65rem 0; border-bottom:1px solid #f1f5f9; font-size:.78rem; }
        .hist-row:last-child { border-bottom:none; }
        .caja-cruda { background:#1e293b; color:#94a3b8; border-radius:1rem; padding:1rem; font-size:.68rem; font-family:monospace; max-height:160px; overflow-y:auto; line-height:1.7; white-space:pre-wrap; word-break:break-all; }
        .badge-ok { background:#dcfce7; color:#166534; font-size:.65rem; padding:2px 10px; border-radius:6px; font-weight:700; }

        /* ── Tabs ── */
        .tab-btn { padding:.45rem 1rem; border-radius:9999px; font-size:.78rem; font-weight:700; cursor:pointer; border:none; transition:all .2s; }
        .tab-btn.active { background:#6366f1; color:#fff; }
        .tab-btn:not(.active) { background:#f1f5f9; color:#64748b; }
        .mtab-btn { padding:.4rem .9rem; border-radius:9999px; font-size:.75rem; font-weight:700; cursor:pointer; border:none; transition:all .2s; }
        .mtab-btn.active { background:#10b981; color:#fff; }
        .mtab-btn:not(.active) { background:#f1f5f9; color:#64748b; }

        /* ── Chart container ── */
        .chart-container { position:relative; height:280px; width:100%; margin-top:1.25rem; }
        .chart-container-sm { position:relative; height:220px; width:100%; }

        /* ── Modal múltiple: cola de archivos ── */
        .recibo-fila {
            display:flex; align-items:center; gap:.6rem;
            background:#f8fafc; border-radius:1rem; padding:.6rem .8rem;
            border-left:4px solid #6366f1; margin-bottom:.4rem;
        }
        .recibo-num {
            width:22px; height:22px; border-radius:50%;
            background:#6366f1; color:#fff;
            font-size:.65rem; font-weight:900;
            display:flex; align-items:center; justify-content:center; flex-shrink:0;
        }
        .recibo-num-sm {
            display:inline-flex; align-items:center; justify-content:center;
            width:20px; height:20px; border-radius:50%;
            color:#fff; font-size:.6rem; font-weight:900; flex-shrink:0;
        }

        /* ── Estado chips de la cola ── */
        .estado-chip { font-size:.6rem; font-weight:700; padding:2px 8px; border-radius:9999px; flex-shrink:0; }
        .chip-pendiente  { background:#e0e7ff; color:#4338ca; }
        .chip-procesando { background:#fef9c3; color:#854d0e; }
        .chip-listo      { background:#dcfce7; color:#166534; }
        .chip-error      { background:#fee2e2; color:#991b1b; }

        /* ── Tabla resultado múltiple ── */
        .tabla-fila { border-bottom:1px solid #f1f5f9; }
        .tabla-fila:last-child { border-bottom:none; }
        .tabla-fila:hover { background:#f8fafc; }
        .tabla-td { padding:.6rem .5rem; vertical-align:middle; }
        .tarifa-badge { font-size:.6rem; font-weight:700; padding:2px 7px; border-radius:9999px; white-space:nowrap; }

        /* ── Stat cards múltiple ── */
        .stat-card { background:#f8fafc; border:1px solid #e2e8f0; border-radius:1.25rem; padding:1rem; text-align:center; }
        .stat-card-red { background:#fef2f2; border-color:#fecaca; }
        .stat-card-green { background:#f0fdf4; border-color:#bbf7d0; }

        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance:none; margin:0; }
    </style>
</head>
<body>

<!-- ═══════════ PORTAFOLIO ═══════════ -->
<main>
    <div class="retry_home">
        <div class="absolute top-6 left-6 z-10">
            <a href="#" class="p-3 bg-white/20 backdrop-blur-md rounded-2xl text-white flex hover:bg-white/40 transition-all">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="3"><path d="m15 18-6-6 6-6"/></svg>
            </a>
        </div>
    </div>

    <div class="perfil">
        <div class="bg-user">
            <div class="flex flex-col items-center text-center">
                <img src="OIP.webp" alt="Avatar" class="w-32 h-32 bg-white object-cover rounded-[2.5rem] shadow-xl"
                     onerror="this.src='https://ui-avatars.com/api/?name=David+Cortes&background=6366f1&color=fff'">
                <h1 class="text-3xl font-extrabold mt-6">David Cortes Cortes</h1>
                <p class="bg-indigo-50 text-indigo-600 px-4 py-1 rounded-full text-sm font-bold mt-2">Ingeniero en Computacion</p>
                <div class="grid grid-cols-2 gap-4 w-full mt-8 text-left">
                    <div class="p-4 bg-slate-50 border border-slate-100 rounded-3xl">
                        <p class="text-[10px] font-black text-slate-400 uppercase italic mb-1">Email:</p>
                        <p class="text-xs font-semibold text-slate-700 truncate">david@email.com</p>
                    </div>
                    <div class="p-4 bg-slate-50 border border-slate-100 rounded-3xl">
                        <p class="text-[10px] font-black text-slate-400 uppercase italic mb-1">Genero:</p>
                        <p class="text-xs font-semibold text-slate-700">Masculino</p>
                    </div>
                </div>
            </div>

            <div class="mt-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="flex items-center gap-2 text-xl font-extrabold text-slate-800">
                        <svg class="w-6 h-6 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                        </svg>
                        Portafolio
                    </h2>
                    <!-- BOTONES -->
                    <div class="flex gap-2">
                        <button onclick="abrirModal()" class="btn-scan">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            Leer Recibo
                        </button>
                        <button onclick="abrirModalMultiple()" class="btn-scan btn-multi">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"/>
                            </svg>
                            Comparar Varios
                        </button>
                    </div>
                </div>
                <div class="bg-slate-50/50 border border-slate-100 rounded-[2rem] p-4">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-white text-indigo-600 rounded-xl shadow-sm">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2z"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-sm font-bold text-slate-800">Herramientas de Analisis CFE</h3>
                            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">Lector simple · Comparador multiple</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>


<!-- ═══════════════════════════════════════════════════════════════ -->
<!-- MODAL 1: LECTOR SIMPLE                                         -->
<!-- ═══════════════════════════════════════════════════════════════ -->
<div id="cfeModal" class="modal-overlay">
    <div class="modal-content">
        <div class="flex justify-between items-center mb-5">
            <div>
                <h3 class="text-xl font-bold text-slate-800">Analisis de Recibo CFE</h3>
                <p class="text-xs text-slate-400">Sube tu PDF o imagen y lo analizamos con OCR</p>
            </div>
            <button onclick="cerrarModal()" class="text-slate-400 hover:text-slate-600 transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>

        <!-- SUBIDA -->
        <div id="paso-subida">
            <div class="drop-zone" id="zonaSubida"
                 onclick="document.getElementById('inputArchivo').click()"
                 ondragover="onDragOver(event)" ondragleave="onDragLeave(event)" ondrop="onDrop(event)">
                <input type="file" id="inputArchivo" accept=".pdf,.jpg,.jpeg,.png,.webp" multiple onchange="onSeleccionArchivo(event)">
                <div id="zonaVacia">
                    <svg class="w-14 h-14 mx-auto text-indigo-300 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <p class="font-bold text-indigo-600">Arrastra tu recibo aqui</p>
                    <p class="text-slate-400 text-xs mt-1">o haz clic para seleccionar · PDF · JPG · PNG · WebP</p>
                </div>
                <div id="zonaConArchivos" class="hidden">
                    <svg class="w-10 h-10 mx-auto text-green-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <div id="listaArchivos" class="flex flex-wrap gap-2 justify-center mt-2"></div>
                    <p class="text-slate-400 text-xs mt-2">Clic para agregar mas archivos</p>
                </div>
            </div>
            <div id="errorSubida" class="hidden mt-3 bg-red-50 border border-red-200 rounded-2xl p-3 text-xs text-red-600 font-semibold"></div>
            <div class="flex gap-3 mt-4">
                <button id="btnProcesar" onclick="iniciarAnalisis()" disabled
                    class="flex-1 py-3 bg-indigo-600 text-white rounded-2xl font-bold text-sm hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition-all disabled:opacity-40 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                    Analizar Ahora
                </button>
                <button onclick="cargarDemo()" class="px-5 py-3 bg-slate-100 text-slate-500 rounded-2xl font-bold text-xs hover:bg-slate-200 transition-all">Demo</button>
            </div>
        </div>

        <!-- CARGANDO -->
        <div id="paso-cargando" class="hidden py-8 text-center">
            <div class="spinner mb-5"></div>
            <p id="msgCarga" class="font-bold text-slate-700 text-sm mb-3">Procesando...</p>
            <div class="barra-fondo mx-auto max-w-xs"><div class="barra-fill" id="barraProgreso" style="width:0%"></div></div>
            <p id="textoPorcentaje" class="text-slate-400 text-xs mt-2">0%</p>
        </div>

        <!-- RESULTADO -->
        <div id="paso-resultado" class="hidden">
            <div class="flex gap-2 mb-5">
                <button class="tab-btn active" onclick="cambiarTab('resumen',this)">Resumen</button>
                <button class="tab-btn" onclick="cambiarTab('historial',this)">Historial</button>
                <button class="tab-btn" onclick="cambiarTab('grafica',this)">Grafica</button>
                <button class="tab-btn" onclick="cambiarTab('crudo',this)">Crudo</button>
            </div>

            <!-- TAB RESUMEN -->
            <div id="tab-resumen">
                <div class="grid grid-cols-3 gap-3 mb-4">
                    <div class="card-id">
                        <p class="text-[9px] font-black text-slate-400 uppercase mb-2">Identificacion</p>
                        <p class="text-[9px] text-slate-400">Titular:</p>
                        <p id="r-titular" class="text-[11px] font-bold text-slate-800 leading-tight mb-1">-</p>
                        <p class="text-[9px] text-slate-400">No. Servicio:</p>
                        <p id="r-servicio" class="text-[11px] font-bold text-slate-800 mb-1">-</p>
                        <p class="text-[9px] text-slate-400">Limite de Pago:</p>
                        <p id="r-limite" class="text-[11px] font-bold text-red-600">-</p>
                    </div>
                    <div class="card-blue flex flex-col items-center justify-center text-center">
                        <p class="text-[9px] font-bold text-blue-200 uppercase mb-1">Consumo Total</p>
                        <p id="r-kwh" class="text-3xl font-black">-</p>
                        <p class="text-xs text-blue-200 font-bold">kWh</p>
                        <p class="text-[9px] text-blue-200 mt-2">Periodo:</p>
                        <p id="r-periodo" class="text-[9px] font-bold text-white leading-tight">-</p>
                    </div>
                    <div class="card-pay">
                        <p class="text-[9px] font-black text-slate-400 uppercase mb-1">Total a Pagar</p>
                        <p id="r-total" class="text-2xl font-black text-green-600 mb-2">-</p>
                        <div class="space-y-1">
                            <div class="flex justify-between text-[9px]"><span class="text-slate-400">Energia:</span><span id="r-energia" class="font-bold text-slate-600">-</span></div>
                            <div class="flex justify-between text-[9px]"><span class="text-slate-400">IVA 16%:</span><span id="r-iva" class="font-bold text-slate-600">-</span></div>
                            <div class="flex justify-between text-[9px] font-black border-t border-slate-100 pt-1 mt-1"><span class="text-slate-600">Fac. Periodo:</span><span id="r-facperiodo" class="text-slate-800">-</span></div>
                            <div class="flex justify-between text-[9px]"><span class="text-slate-400">DAP:</span><span id="r-dap" class="font-bold text-slate-600">-</span></div>
                            <div class="flex justify-between text-[9px]"><span class="text-slate-400">Adeudo Ant.:</span><span id="r-adeudo" class="font-bold text-slate-600">-</span></div>
                            <div class="flex justify-between text-[9px]"><span class="text-slate-400">Su Pago:</span><span id="r-pago" class="font-bold text-slate-600">-</span></div>
                        </div>
                        <div class="mt-2"><span class="badge-ok">Analizado</span></div>
                    </div>
                </div>
                <div class="eng-card">
                    <h4 class="font-black text-slate-800 text-sm mb-3">Analisis de Ingenieria</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bl-blue"><p class="text-[10px] font-black text-slate-500 uppercase">Media Diaria</p><p id="r-media" class="text-base font-black text-slate-800">-</p></div>
                        <div class="bl-yellow"><p class="text-[10px] font-black text-slate-500 uppercase">Clasificacion</p><p id="r-clasificacion" class="text-base font-black text-slate-800">-</p></div>
                    </div>
                </div>
            </div>

            <!-- TAB HISTORIAL -->
            <div id="tab-historial" class="hidden">
                <div class="eng-card">
                    <h4 class="font-black text-slate-800 text-sm mb-3">Historial de Consumo</h4>
                    <div id="r-historial"><p class="text-xs text-slate-400 italic">No se encontro historial.</p></div>
                </div>
            </div>

            <!-- TAB GRAFICA -->
            <div id="tab-grafica" class="hidden">
                <div class="eng-card">
                    <h4 class="font-black text-slate-800 text-sm mb-2">Consumo historico (kWh)</h4>
                    <div class="chart-container"><canvas id="cfeChart"></canvas></div>
                </div>
            </div>

            <!-- TAB CRUDO -->
            <div id="tab-crudo" class="hidden">
                <p class="text-xs font-bold text-slate-500 mb-2">Texto Crudo Extraido:</p>
                <div class="caja-cruda" id="textoCrudo">Sin datos</div>
            </div>

            <div class="flex gap-3 mt-5">
                <button onclick="reiniciarModal()" class="flex-1 py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl hover:bg-slate-200 transition-all text-sm">Analizar otro</button>
                <button onclick="abrirComparativa()"
                    class="flex-1 py-3 bg-indigo-600 text-white rounded-2xl font-bold hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition-all text-sm flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    Comparar Consumo
                </button>
            </div>
        </div>

        <!-- ERROR -->
        <div id="paso-error" class="hidden text-center py-8">
            <svg class="w-14 h-14 mx-auto text-red-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
            <p class="font-bold text-red-600 text-sm">Error al analizar</p>
            <p id="mensajeError" class="text-slate-400 text-xs mt-1 max-w-xs mx-auto"></p>
            <button onclick="reiniciarModal()" class="mt-5 px-6 py-2 bg-slate-100 text-slate-600 rounded-xl font-bold text-sm hover:bg-slate-200 transition-all">Intentar de nuevo</button>
        </div>
    </div>
</div>

<!-- MODAL COMPARATIVA SIMPLE -->
<div id="compModal" class="modal-overlay">
    <div class="modal-content shadow-2xl">
        <div class="flex justify-between items-center mb-6">
            <div><h3 class="text-xl font-bold text-slate-800">Comparativa de Consumo</h3><p class="text-xs text-slate-400">Compara recibos de distintos usuarios</p></div>
            <button onclick="cerrarComparativa()" class="text-slate-400 hover:text-slate-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"/></svg></button>
        </div>
        <div id="comp-input">
            <div id="people-container" class="space-y-3 mb-6"></div>
            <div class="flex gap-3">
                <button onclick="agregarFila()" class="flex-1 py-3 border-2 border-dashed border-indigo-200 text-indigo-500 rounded-2xl font-bold flex items-center justify-center gap-2 hover:bg-indigo-50 transition-all text-sm">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4"/></svg>
                    Agregar Persona
                </button>
                <button onclick="procesarComparativa()" class="px-8 bg-indigo-600 text-white rounded-2xl font-bold hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition-all text-sm">Comparar</button>
            </div>
        </div>
        <div id="comp-results" class="hidden">
            <div class="grid grid-cols-2 gap-4 mb-5">
                <div class="bg-red-50 p-4 rounded-2xl border border-red-100"><h4 class="text-red-900 font-bold text-[10px] uppercase mb-1">Mayor Consumo</h4><p id="comp-max-name" class="text-lg font-black text-red-700">-</p><p id="comp-max-kwh" class="text-sm font-bold text-red-400">0 kWh</p></div>
                <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100"><h4 class="text-slate-500 font-bold text-[10px] uppercase mb-1">Promedio Grupal</h4><p id="comp-avg" class="text-lg font-black text-slate-700">0 kWh</p><p class="text-[10px] text-slate-400 italic">Basado en datos ingresados</p></div>
            </div>
            <h4 class="font-bold text-slate-800 mb-1 text-sm">Comparativa de Gastos</h4>
            <div class="chart-container"><canvas id="compChart"></canvas></div>
            <button onclick="mostrarInputsComparativa()" class="mt-5 w-full py-3 bg-slate-100 text-slate-600 font-bold rounded-xl hover:bg-slate-200 transition-all text-sm">Modificar datos</button>
        </div>
    </div>
</div>


<!-- ═══════════════════════════════════════════════════════════════ -->
<!-- MODAL 2: LECTOR MÚLTIPLE                                       -->
<!-- ═══════════════════════════════════════════════════════════════ -->
<div id="multiModal" class="modal-overlay">
    <div class="modal-content modal-wide">

        <!-- Cabecera -->
        <div class="flex justify-between items-center mb-5">
            <div>
                <h3 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                    <span class="w-7 h-7 bg-emerald-500 rounded-xl flex items-center justify-center">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"/>
                        </svg>
                    </span>
                    Comparador Multiple de Recibos
                </h3>
                <p class="text-xs text-slate-400">Carga de 2 a 20 recibos CFE y compara su consumo, costo y clasificacion</p>
            </div>
            <button onclick="cerrarModalMultiple()" class="text-slate-400 hover:text-slate-600 transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>

        <!-- ── PASO SUBIDA ── -->
        <div id="mpaso-subida">
            <!-- Drop zone verde -->
            <div class="drop-zone drop-zone-green" id="multiZona"
                 onclick="document.getElementById('multiInput').click()"
                 ondragover="multiDragOver(event)" ondragleave="multiDragLeave(event)" ondrop="multiDrop(event)">
                <input type="file" id="multiInput" accept=".pdf,.jpg,.jpeg,.png,.webp" multiple onchange="multiSeleccion(event)">
                <div id="multiZonaVacia">
                    <svg class="w-12 h-12 mx-auto text-emerald-300 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                    </svg>
                    <p class="font-bold text-emerald-600">Arrastra todos tus recibos aqui</p>
                    <p class="text-slate-400 text-xs mt-1">Minimo 2, maximo 20 · PDF · JPG · PNG · WebP</p>
                </div>
                <div id="multiZonaLlena" class="hidden">
                    <p class="font-bold text-emerald-700 mb-1">
                        <span id="multiContador" class="text-2xl font-black">0</span> recibos listos
                    </p>
                    <p class="text-slate-400 text-xs">Clic para agregar mas</p>
                </div>
            </div>

            <div id="multiError" class="hidden mt-2 bg-red-50 border border-red-200 rounded-xl p-2 text-xs text-red-600 font-semibold"></div>

            <!-- Cola de archivos -->
            <div id="multiCola" class="mt-3 max-h-48 overflow-y-auto space-y-1 pr-1"></div>

            <!-- Botones -->
            <div class="flex gap-3 mt-4">
                <button id="multiBtnProcesar" onclick="procesarMultiple()" disabled
                    class="flex-1 py-3 bg-emerald-500 text-white rounded-2xl font-bold text-sm hover:bg-emerald-600 shadow-lg shadow-emerald-200 transition-all disabled:opacity-40 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                    Analizar y Comparar
                </button>
                <button onclick="cargarDemoMultiple()" class="px-5 py-3 bg-slate-100 text-slate-500 rounded-2xl font-bold text-xs hover:bg-slate-200 transition-all">Demo (5 recibos)</button>
            </div>
            <p class="text-center text-[10px] text-slate-400 mt-2 font-semibold">Necesitas al menos 2 recibos para comparar</p>
        </div>

        <!-- ── PASO PROCESANDO ── -->
        <div id="mpaso-procesando" class="hidden py-8 text-center">
            <div class="spinner spinner-green mb-5"></div>
            <p id="mMsgCarga" class="font-bold text-slate-700 text-sm mb-3">Analizando recibos...</p>
            <div class="barra-fondo mx-auto max-w-xs">
                <div class="barra-fill barra-fill-green" id="mBarraProgreso" style="width:0%"></div>
            </div>
            <p id="mTextoPct" class="text-slate-400 text-xs mt-2">0%</p>
            <!-- Cola en vivo -->
            <div id="multiColaLive" class="mt-5 max-h-40 overflow-y-auto space-y-1 text-left"></div>
        </div>

        <!-- ── PASO RESULTADO ── -->
        <div id="mpaso-resultado" class="hidden">

            <!-- Estadísticas globales -->
            <div class="grid grid-cols-4 gap-3 mb-5">
                <div class="stat-card">
                    <p class="text-[9px] font-black text-slate-400 uppercase mb-1">Recibos</p>
                    <p id="mres-total-recibos" class="text-2xl font-black text-slate-700">-</p>
                </div>
                <div class="stat-card">
                    <p class="text-[9px] font-black text-slate-400 uppercase mb-1">Prom. Consumo</p>
                    <p id="mres-prom-kwh" class="text-lg font-black text-indigo-600">-</p>
                </div>
                <div class="stat-card stat-card-green">
                    <p class="text-[9px] font-black text-emerald-600 uppercase mb-1">Menor consumo</p>
                    <p id="mres-min-nombre" class="text-xs font-black text-emerald-700 truncate">-</p>
                    <p id="mres-min-kwh" class="text-base font-black text-emerald-600">-</p>
                </div>
                <div class="stat-card stat-card-red">
                    <p class="text-[9px] font-black text-red-500 uppercase mb-1">Mayor consumo</p>
                    <p id="mres-max-nombre" class="text-xs font-black text-red-700 truncate">-</p>
                    <p id="mres-max-kwh" class="text-base font-black text-red-500">-</p>
                </div>
            </div>

            <!-- Tabs gráficas -->
            <div class="flex gap-2 mb-4">
                <button class="mtab-btn active" onclick="cambiarTabMulti('kwh',this)">Consumo kWh</button>
                <button class="mtab-btn" onclick="cambiarTabMulti('costo',this)">Costo $</button>
                <button class="mtab-btn" onclick="cambiarTabMulti('radar',this)">Radar</button>
                <button class="mtab-btn" onclick="cambiarTabMulti('tabla',this)">Tabla</button>
            </div>

            <!-- TAB kWh -->
            <div id="mtab-kwh">
                <div class="eng-card">
                    <div class="chart-container"><canvas id="mGrafKwh"></canvas></div>
                </div>
            </div>

            <!-- TAB Costo -->
            <div id="mtab-costo" class="hidden">
                <div class="eng-card">
                    <div class="chart-container"><canvas id="mGrafCosto"></canvas></div>
                </div>
            </div>

            <!-- TAB Radar -->
            <div id="mtab-radar" class="hidden">
                <div id="mRadarContainer" class="eng-card">
                    <p class="text-[10px] text-slate-400 font-bold mb-2 text-center">Comparativa normalizada (0–100) por dimension</p>
                    <div class="chart-container"><canvas id="mGrafRadar"></canvas></div>
                </div>
                <div id="mRadarAviso" class="hidden text-center py-6 text-slate-400 text-xs">El radar solo se muestra con 8 recibos o menos.</div>
            </div>

            <!-- TAB Tabla -->
            <div id="mtab-tabla" class="hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left" style="border-collapse:collapse;">
                        <thead>
                            <tr class="border-b-2 border-slate-200">
                                <th class="tabla-td text-[9px] font-black text-slate-400 uppercase">#</th>
                                <th class="tabla-td text-[9px] font-black text-slate-400 uppercase">Titular</th>
                                <th class="tabla-td text-[9px] font-black text-slate-400 uppercase text-center">kWh</th>
                                <th class="tabla-td text-[9px] font-black text-slate-400 uppercase text-center">Total</th>
                                <th class="tabla-td text-[9px] font-black text-slate-400 uppercase text-center">Media/dia</th>
                                <th class="tabla-td text-[9px] font-black text-slate-400 uppercase text-center">Tarifa</th>
                                <th class="tabla-td text-[9px] font-black text-slate-400 uppercase text-center">Periodo</th>
                            </tr>
                        </thead>
                        <tbody id="mres-tabla"></tbody>
                    </table>
                </div>
            </div>

            <!-- Acciones -->
            <div class="flex gap-3 mt-5">
                <button onclick="reiniciarMultiple()" class="flex-1 py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl hover:bg-slate-200 transition-all text-sm">Nueva comparativa</button>
                <button onclick="exportarCSV()"
                    class="px-6 py-3 bg-emerald-500 text-white rounded-2xl font-bold hover:bg-emerald-600 shadow-lg shadow-emerald-200 transition-all text-sm flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                    </svg>
                    Exportar CSV
                </button>
            </div>
        </div>

    </div>
</div>

<!-- Scripts -->
<script src="js/lector.js"></script>
<script src="js/lector_multiple.js"></script>
</body>
</html>